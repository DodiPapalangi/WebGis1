<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Sedimentasi DAS Lisu</title>
    <!-- Memuat Bootstrap untuk styling yang baik -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- PENTING: Memperbarui ke Font Awesome versi 6.5.1 untuk memastikan semua ikon Folium tampil -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* Kontainer Utama (Card) */
        .map-wrapper {
            /* Batasi lebar maksimum tampilan peta agar tidak terlalu besar di desktop */
            max-width: 1000px; 
            margin-left: auto;
            margin-right: auto;
        }

        /* Kontainer Peta Folium */
        #map-container {
            height: 600px; /* Tinggi peta sedikit dikurangi menjadi 600px */
            width: 100%;
        }
        
        .card-body-map {
            height: 600px;
            padding: 0 !important;
        }
    </style>
</head>
<body class="container py-4">

    <h1 class="mb-4 text-center">Peta Sedimentasi DAS Lisu</h1>

    <!-- TAMPILAN ERROR: Menampilkan pesan error dari Python (jika ada) -->
    {% if error %}
    <div class="alert alert-danger" role="alert">
        <strong>Peringatan!</strong> Peta tidak dimuat dengan benar.
        <br>{{ error }}
        <br>Cek kembali jalur file shapefile.
    </div>
    {% endif %}

    <!-- FORM FILTER -->
    <form action="/" method="POST" class="row g-3 mb-4">
        <div class="col-md-4">
            <label for="filter_kecamatan" class="form-label">Filter Kecamatan</label>
            <select id="filter_kecamatan" name="filter_kecamatan" class="form-select">
                <option value="Semua" {% if selected_kecamatan == 'Semua' %}selected{% endif %}>Semua Kecamatan</option>
                {% for kecamatan in unique_kecamatan %}
                <option value="{{ kecamatan }}" {% if selected_kecamatan == kecamatan %}selected{% endif %}>{{ kecamatan }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <label for="filter_kelas" class="form-label">Filter Kelas Sedimentasi</label>
            <select id="filter_kelas" name="filter_kelas" class="form-select">
                <option value="Semua" {% if selected_kelas == 'Semua' %}selected{% endif %}>Semua Kelas</option>
                {% for kelas in unique_kelas %}
                <option value="{{ kelas }}" {% if selected_kelas == kelas %}selected{% endif %}>{{ kelas }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Tampilkan Peta</button>
        </div>
    </form>
    
    <!-- WRAPPER BARU untuk membatasi lebar peta -->
    <div class="map-wrapper">
        <div class="card shadow-lg border-0">
            <div class="card-body card-body-map">
                <div id="map-container">
                    {{ map_html | safe }}
                </div>
            </div>
        </div>
    </div>

    <!-- Script Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
